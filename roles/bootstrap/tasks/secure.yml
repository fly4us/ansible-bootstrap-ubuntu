---
- name: Install fail2ban
  apt:
    pkg=fail2ban
    state=installed

- name: Disallow password authentication
  lineinfile:
    dest=/etc/ssh/sshd_config
    regexp="^Port"
    line="Port 8002"
    state=present
  notify:
    - restart ssh

- name: Disallow password authentication
  lineinfile:
    dest=/etc/ssh/sshd_config
    regexp="^PasswordAuthentication"
    line="PasswordAuthentication no"
    state=present
  notify:
    - restart ssh

- name: Disallow root SSH access
  lineinfile:
    dest=/etc/ssh/sshd_config
    regexp="^PermitRootLogin"
    line="PermitRootLogin no"
    state=present
  notify:
    - restart ssh

- name: Delete /etc/sudoers.d/ files
  shell:
    rm -f /etc/sudoers.d/*

- name: Install packages
  apt:
    pkg=ufw
    state=installed

- name: Setup ufw 8002/tcp
  shell:
    ufw allow 8002/tcp

- name: Enable ufw
  shell:
    echo 'y' | ufw enable

- name: Delete root password
  shell:
    passwd -d root
